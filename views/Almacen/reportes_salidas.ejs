<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Almacen</title>
  <%- include("../partials/head") -%>	
<style type="text/css">
	@media print{
	  @page {
		size: A4 landscape;
		margin: 0;
	}
	.margeni{
		width: 100%;
		border: 1px;
		position: relative;
		border-top-style: dashed;
		border-bottom-style: dotted;
		border-left-style: solid; 
	}
	#sacar{
		height: 9%;
	
		overflow-x: hidden;
	}
	.ordendetitulo{
		position: absolute;
		float: center;
		top: 20%;
		bottom: 1%;
		margin-top: 3%;
		margin-left: 12;
		padding-left: 30%;	
	}
	.cafirma1{
    	width: 25%;
    	margin-left: 5%;
    	float:left;
    	border-top-style: dotted;
	}
	.cafirma2{
	    width: 25%;   
	    margin-right: 5%;
	    float: right;
	    border-top-style: dotted;
	}
	#sinMarge{
    top: 2%;
    border: 0px;
   padding-left: 0% ;
    padding-top: 0%;
   margin-left: 0%;
    margin-right: 0%;
  
    padding: 0px;
    
    position: relative;

    border-top-style: dashed;
    border-right-style: double;
  
    border-left-style: solid; 

}
.texTitulo1:before {
    content: " REPORTE ADMINISTRATIVO DE ALMACEN";
    font-weight: negrita;
    color:black;
    font: small-caps 100%/200% serif;
    margin-bottom: 0;
}
 	}
</style>
<style>
	.vertical-alignment-helper {
	  display:table;
	  height: 100%;
	  margin-left: 41%;
	}
	.vertical-align-center {
	  /* To center vertically */
	  display: table-cell;
	  vertical-align: middle;
	  text-align: center;
	}
</style>
</head>
<script type="text/javascript">
	// este scrip es para verificar si esta el token en local starge
	var data = localStorage.getItem('data')
	console.log(data)
	if (data == null){
		window.location.replace('/')
  }
  function delete_local_storage(){
		console.log ("ssss")
		localStorage.removeItem('data');
		localStorage.removeItem('url');
  }
  setTimeout(()=>{
    delete_local_storage()
    //window.location.replace('/')
  },500000);
</script>
<body class="light_theme  fixed_header left_nav_fixed" onload="actualizaReloj()">
  	<div class="wrapper" id="vue_reportes">
    	<div id="ocultoI" class="header_bar">
      		<div class="brand">
        		<div class="logo" style="display:block"><span class="theme_color">Hospital</div>
      		</div>
      		<div class="header_top_bar">
        		<a href="javascript:void(0);" class="menutoggle"> <i class="fa fa-bars"></i></a>
        		<div class="top_right_bar">
          			<div class="user_admin dropdown"> <a href="javascript:void(0);" data-toggle="dropdown">
						  <img src="/images/farmacia.png" /><span class="user_adminname"><span>&nbsp;&nbsp;</span> <%=data_doc.data.personal.nombre%> <%=data_doc.data.personal.apellidop%></span> <b class="caret"></b> </a>
            			<ul class="dropdown-menu">
              				<div class="top_pointer"></div>
              				<li> <a href="javascript:void(0);" data-target="#myModalCerrar" data-toggle="modal" ><i class="fa fa-power-off"></i> Salir</a> </li>
            			</ul>
          			</div> 
        		</div>
      		</div>
    	</div>
    	<div class="inner">
      		<div id="ocultoI" class="left_nav">
        		<div class="left_nav_slidebar">
          			<ul>
            			<li><a href="javascript:void(0);"><i class="fa fa-home"></i> Home <span class="left_nav_pointer"></span> <span class="plus"><i class="fa fa-plus"></i></span> </a>
              				<ul>
                				<li> <a href="/almacen/home/<%=data_doc.data.token_id%>/<%=data_doc.data.token_part%>" > <span>&nbsp;</span> <i class="fa fa-circle theme_color"></i> <b>Inicio</b> </a> </li>
              				</ul>
            			</li>
            			<li> <a href="javascript:void(0);"> <i class="fa fa-hospital-o icon"></i>Almacen <span class="plus"><i class="fa fa-plus"></i></span></a>
              				<ul>
                				<li> <a href="/almacen/grupoAsig/<%=data_doc.data.token_id%>/<%=data_doc.data.token_part%>"> <span>&nbsp;</span> <i class="fa fa-circle"></i> <b>Grupos de Asignacion</b> </a> </li>
                				<li> <a href="/medicamento/medicamentos/<%=data_doc.data.token_id%>/<%=data_doc.data.token_part%>"> <span>&nbsp;</span> <i class="fa fa-circle"></i> <b>Medicamentos</b> </a> </li>
                				<li> <a href="/proveedores/proveedores/<%=data_doc.data.token_id%>/<%=data_doc.data.token_part%>"> <span>&nbsp;</span> <i class="fa fa-circle"></i> <b>Proveedores</b> </a> </li>
                				<li> <a href="/almacen/pedidos/<%=data_doc.data.token_id%>/<%=data_doc.data.token_part%>"> <span>&nbsp;</span> <i class="fa fa-circle"></i> <b>Pedidos</b> </a> </li>
                				<li> <a href="/distribucion/listDistribucion/<%=data_doc.data.token_id%>/<%=data_doc.data.token_part%>"> <span>&nbsp;</span> <i class="fa fa-circle"></i> <b>Distribucion</b> </a> </li>
                				<li> <a href="/medicamento/stock/<%=data_doc.data.token_id%>/<%=data_doc.data.token_part%>"> <span>&nbsp;</span> <i class="fa fa-circle"></i> <b>Stock</b> </a> </li>   
							</ul>
            			</li>
            			<li class="left_nav_active theme_border"> <a href="javascript:void(0);"> <i class="fa fa-paste"></i> Reportes Almacen<span class="plus"><i class="fa fa-plus"></i></span> </a>
              				<ul class="opened" style="display:block">
                				<li> <a href="/almacen/reportes_pedidos/<%=data_doc.data.token_id%>/<%=data_doc.data.token_part%>"> <span>&nbsp;</span> <i class="fa fa-circle"></i> <b>Reportes de Pedidos </b></a></li>
                				<li> <a href="/almacen/reportes_salidas/<%=data_doc.data.token_id%>/<%=data_doc.data.token_part%>"> <span>&nbsp;</span> <i class="fa fa-circle"></i> <b class="theme_color">Reportes de Salidas</b> </a> </li>
                				<li> <a href="/almacen/kardexValorizado/<%=data_doc.data.token_id%>/<%=data_doc.data.token_part%>"> <span>&nbsp;</span> <i class="fa fa-circle"></i> <b>Kardex Valorizado</b> </a> </li>
                				<li> <a href="/almacen/med_ven/<%=data_doc.data.token_id%>/<%=data_doc.data.token_part%>"> <span>&nbsp;</span> <i class="fa fa-circle"></i> <b>Med. Vencidos</b> </a> </li>
              				</ul>
            			</li>
          			</ul>
        		</div>
      		</div>
     		<!--Contenido-->
			 <div id="sinMarge" class="contentpanel"><br>
				<div class="container clear_both padding_fix col-lg-8">
					<div class="main-content">
					  	<div class="col-lg-12 block-web">
							<div class="container-fluid">
								<div class="head">
									<div class="actions">
										<!--<<<<<<<<<<<<<< IMAGEN en la hoja de impresion>>>>>>>>>>>>>>>>>>>>>>>-->
										<P class="dondeES"></P>
										<p class="telefo"></p>
										<!--<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<-->	
										<p class="fechaI" name="fechaConsulta" id="Fecha_Reloj"  readonly=""  cols="23" rows="1,9px" ></p>
									</div>
									<!--<<<<<<<<<<<<<< IMAGEN en la hoja de impresion>>>>>>>>>>>>>>>>>>>>>>>-->
									<div class="dim2 posiondeImagen">
										<img class="oculVistaReal "  src="/images/hospital1.png" />
										<p class="hospitalI"></p>
									</div>
									<!--<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<-->
									<div id="ocultoI" class="header">
										<h2 class="content-header"><div class="info gray_symbols"><i class="fa fa-bar-chart-o icon"></i></div>Reporte de Salidas</h2>
									</div>
									
								</div>
							</div>
						</div>
						<div class="main-content"> 
							<section class="panel default blue_title h2">
								<!--<<<<<<<<<<<<<< Solo se vera en la hoja de impresion>>>>>>>>>>>>>>>>>>>>>>>-->
								<h4 class="texTitulo1 ordendetitulo center"></h4>
								<!--<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<-->
							
							  	<div class="page-content">
									<ul class="nav nav-tabs" id="ocultoI">
									  	<li class=" col-lg-6 active active  text-center"><a href="#neww" data-toggle="tab"><i class="fa fa-edit icon"></i><span>&nbsp;&nbsp;&nbsp;</span>Solicitudes de Farmacia </a></li>
								  		<li class="col-lg-6 text-center"><a href="#listt" data-toggle="tab"><i class="fa fa-clipboard "></i><span>&nbsp;&nbsp;&nbsp;</span>Distribuciones Realizadas</a></li>
									</ul>
									<div id="myTabContent" class="tab-content">
										
								  		<div class="tab-pane fade active in " id="neww">
											<div id="ocultoI" class="panel-body">
												<form  @submit="traer_list" method="POST" parsley-validate novalidate>
													<div class="col-md-12">
														<div class="col-md-6">
															<div class="form-group">
																<label class="col-sm-3 control-label">DESDE:</label>
																<input v-model="fecha_inicio" type="date" class="form-control" >
															</div><!--/form-group--> 
														</div>
														<div class="col-md-6">
															<div class="form-group">
																<label class="col-sm-3 control-label">HASTA:</label>
																<input v-model="fecha_final" type="date" class="form-control" >
															</div><!--/form-group-->
														</div>
													</div>
													<div class="col-md-12">
														<div class="col-md-6">
															<div class="form-group">
															  	<label class="col-sm-4 control-label">DISTRIBUIDO <i class="fa fa-users"></i> :</label>
																<select v-model="id_personal" >
																	<%for( var i = 0; i < personal_farmacia[0].user.length; i++ ) { %>
																		<option value="<%=personal_farmacia[0].user[i].Registro_personal.id%>"><%=personal_farmacia[0].user[i].Registro_personal.nombre%></option>
																	<% } %>
																
																</select>
															</div><!--/form-group-->
														</div>
														<div class="col-md-6">
															<div class="form-group">
																<div class="col-sm-offset-2 col-sm-10">
																	<button type="submit" class="btn btn-success"><i class="fa fa-bar-chart-o"></i>  Generar Reporte</button>
																	<a id="ocultoI" onclick="window.print();" class="btn btn-warning btn-raised" style="margin-right: 20px;"> <i class='fa fa-print'></i>&nbsp;&nbsp; Imprimir Reporte</a>
																</div>
															</div><!--/form-group--> 
														</div> <br> <br>
														<div class="col-md-6" v-if="list != ''">
															<div class="form-group">
																<div class="col-sm-offset-2 col-sm-10">
																	<button @click = "list = ''" type="submit" class="btn btn-warning"><i class="fa fa-print"></i>Volver </button>
																</div>
															</div><!--/form-group-->															
														</div>
													</div>
												</form>
											</div>
											<table  class="table table-bordered table-striped" >
									  			<thead>
													<tr>
													<th>#</th>
													<th>Nro. de Solicitud</th>
													<th>Responsable</th>
													<th>Fecha</th>
													<th>Trimestre</th>
													<th>Estado</th>
													<th>Destino</th>
													</tr>
											  	</thead>
									  			<tbody>
													<template v-if="list != ''">
														<tr v-for="(data, index) in list">
															<td>{{index}}</td>
															<td>{{data.num_solicitud}} </td>
															<td>{{data.responsable}}</td>
															<td>{{data.createdAt}}</td>
															<td>{{data.trimestre}}</td>	
															
															<template v-if="data.medicamento_mandado_almacen == null">
																<td><span style="color: crimson;">Nueva Solicitud</span></td>
															</template>
															<template v-else>
																<td><span style="color: rgb(220, 173, 20);">Enviado a Farmacia</span></td>
															</template>
															
															<td>{{data.destino}}</td>
														</tr>
													</template>
													<template v-else>
														<% for(var i = 0; i < dat.length; i++) { %>
															<tr>
																<td><%=i+1%></td>
																<td><%=dat[i].num_solicitud%></td>
																<td><%=dat[i].responsable%></td>
																<td><%=dat[i].createdAt%></td>
																<td><%=dat[i].trimestre%></td>		
																<% if (dat[i].medicamento_mandado_almacen == null) { %>											
																	<td><span style="color: crimson;">Nueva Solicitud</span></td>
																<% } else { %>
																	  <td><span style="color: rgb(220, 173, 20);">Enviado a Farmacia</span></td>
																<% } %>
																<td><%=dat[i].destino%></td>
															</tr>
														<% } %>
													</template>
													
									  			<tbody>
											</table>
								 	 	</div>
								  		<div class="tab-pane fade " id="listt">
											<div class="porlets-content">
									  			<div id="ocultoI" class="panel-body">
													<form @submit="list_distribucion_filter" method="POST" parsley-validate novalidate>
														<div class="col-md-12">
															<div class="col-md-6">
																<div class="form-group">
																	<label class="col-sm-3 control-label">DESDE:</label>
																	<input v-model="fecha_inicio1" type="date" class="form-control" >
																</div><!--/form-group--> 
															</div>
															<div class="col-md-6">
																<div class="form-group">
																	<label class="col-sm-3 control-label">HASTA:</label>
																	<input v-model="fecha_final1" type="date" class="form-control" >
																</div><!--/form-group-->
															</div>
														</div>
														<div class="col-md-12">
															<div class="col-md-6">
																<div class="form-group">
																  	<label class="col-sm-4 control-label">DISTRIBUIDO <i class="fa fa-users"></i> :</label>
																	<select v-model="id_personal1">
																		<%for( var i = 0; i < personal_farmacia[0].user.length; i++ ) { %>
																			<option value="<%=personal_farmacia[0].user[i].Registro_personal.id%>"><%=personal_farmacia[0].user[i].Registro_personal.nombre%></option>
																		<% } %>
																	</select>
																</div><!--/form-group-->
															</div>
															<div class="col-md-6">
																<div class="form-group">
																	<div class="col-sm-offset-2 col-sm-10">
																		<button type="submit" class="btn btn-success"><i class="fa fa-bar-chart-o"></i>  Generar Reporte</button>
																		<a id="ocultoI" onclick="window.print();" class="btn btn-warning btn-raised" style="margin-right: 20px;"> <i class='fa fa-print'></i>&nbsp;&nbsp; Imprimir Reporte</a>
																	</div>
																</div><!--/form-group-->															
															</div>
															<div class="col-md-6" v-if="list_pedidos != ''">
																<div class="form-group">
																	<div class="col-sm-offset-2 col-sm-10">
																		<button @click = "list_pedidos = ''" type="submit" class="btn btn-warning"><i class="fa fa-print"></i>Volver </button>
																	</div>
																</div><!--/form-group-->															
															</div>
														
														</div>
													</form>
												</div >
									  			<div class="table-responsive">
													<table  class="table table-bordered table-striped">
														<thead>
															<tr>
															<th>#</th>
															<th>Fecha</th>
														  	<th>Codigo de Distribucion</th>
															<th>Responsable</th>
															<th>Distribuido</th>
															<th>Cantidad Total</th>
															</tr>
														</thead>
														<tbody>
															<template v-if="list_pedidos != ''">
																
																<tr v-for="(list, index) in list_pedidos ">
																	<td>{{index + 1}}</td>
																	<td>{{list.fechaLlegada}}</td>
																	<td>{{list.codigo}}</td>
																	<td>{{list.responsable}}</td>
																	<td>{{list.recibe}}</td>
																	<td>falta</td>
																</tr>
																
															</template>
															<template v-else>
																<% for(var i = 0; i < data.length; i++) { %>
																	<tr>
																		<td><%=i+1%></td>
																		<td><%=data[i].fechaLlegada%></td>
																		<td><%=data[i].codigo%></td>
																		<td><%=data[i].responsable%></td>
																		<td><%=data[i].recibe%></td>
																		<td>falta</td>
																	</tr>
																<% } %>
															</template>
														  
														</tbody>
													</table>
									  			</div><!--/table-responsive-->
											</div><!--/porlets-content-->    
										</div>
									</div>
							  	</div>
							</section>
						</div>
					</div>
					<br><br><br><br><br><br><br><br><br><br><br><br>
					<!--<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< solo se vera en  imprimir >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><>>>-->
					<p class="firmaPa center cafirma1"></p>										  
					<p class="firmaDoc center cafirma2"></p></p>
					<!--<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>><>>>-->
			
				</div> 
		 	</div><!--/main-content end--> 
		</div>
	</div>
 	<!-- Modal -->
	<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
	  		<div class="modal-content">
				<div class="modal-header">
		  			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		  			<h4 class="modal-title" id="myModalLabel"><i class="fa fa-bar-chart-o icon"></i> Reportes de Salidas</h4>
				</div>
				<div class="modal-body"> 
		  			<form class="form-horizontal"   parsley-validate novalidate>
						<div class="form-group">
			  				<label for="inputEmail3" required parsley-type="desde" class="col-sm-2 control-label">DESDE:</label>
			  				<div class="col-sm-4">
								<input type="date" class="form-control" >
			  				</div>
						</div><!--/form-group--> 
						<div class="form-group">
			  				<label for="inputPassword3" required parsley-type="hasta" class="col-sm-2 control-label">HASTA:</label>
			  				<div class="col-sm-4">
								<input type="date" class="form-control" >
			  				</div>
						</div><!--/form-group-->  
						<div class="form-group">
			  				<label for="inputPassword3" class="col-sm-2 control-label">Distibuido <i class="fa fa-users"> :</i></label>
			  				<div class="col-sm-4">
								<select class="selectpicker" data-show-subtext="true" data-live-search="true">
				 	 				<option>Paco</option>
				  					<option>Luis</option>
				  					<option>Luna</option>
				  					<option>Daniela</option>
								</select><br>
			  				</div>
						</div><!--/form-group-->
						<div class="form-group">
			  				<div class="col-sm-offset-2 col-sm-10">
								<button type="submit" class="btn btn-primary">Aceptar</button>
								<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
			  				</div>
						</div><!--/form-group--> 
		 	 		</form>
				</div>
	  		</div>
		</div>
	</div>
	<div class="modal fade" id="myModalCerrar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    
		<div class="vertical-alignment-helper">
		  <div class="modal-dialog vertical-align-center modal-sm ">
			<div class="modal-content">
			  <br>
			  <div class="center">
				<i><img src="/images/salir.gif" width="100" height="100" /></i>
			  </div>
			  <div class="center">
				<h5><b>¿Cerrar Sesión?</b></h5>
			  </div>
			  <div class="modal-footer">
				<div class="center">
				  <a href="/delete_token/<%=data_doc.data.token_id%>" onclick="delete_local_storage()" class="btn btn-success"><i class="fa fa-check"></i><span>&nbsp;</span>Sí, Confirmar</a>
				  <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i><span>&nbsp;</span>No, Cancelar</button>
				</div>
			  </div>
			</div>
		  </div>
		</div> 
	 </div>
<%- include("../partials/scripts") -%>
<script src="/js/pdf.js"></script>
<script src="/js/fecha.js"></script>
<script>
	const vue_reportes = new Vue({
  		el: '#vue_reportes', 
  		data : () => ({
			url:data_url.url_front_end,
			data:"aljand321",

			fecha_inicio: '',
			fecha_final:'', 
			id_personal:'',

			fecha_inicio1: '',
			fecha_final1:'', 
			id_personal1:'',

			list: '',
			list_pedidos:''
		}),
		methods:{ 
			traer_list(e){
				e.preventDefault();
				var datos = {
					fecha_inicio: this.fecha_inicio,
					fecha_final:this.fecha_final, 
					id_personal:this.id_personal,
            	}
            	var esto = {
            	  method: 'POST',
            	  body: JSON.stringify(datos),
            	  headers:{
            	    'Content-type' : "application/json"
            	  }
            	};
            	fetch(this.url+'/almacen/filter_data_pedidos',esto)
            	.then(res => res.json())
            	.catch(error => console.error('Error:', error))
            	.then(data => {
					console.log(data)
					if(data.success == false){
						swal.fire(
                        	'Error!',
                        	'<label style="color:red;">'+data.msg+'</label>',
                        	'error'
                    	)
						
					}else{
						this.list = data	
					}				
				})
			},

			list_distribucion_filter(e){
				e.preventDefault();
				var datos = {
					fecha_inicio: this.fecha_inicio1,
					fecha_final:this.fecha_final1, 
					id_personal:this.id_personal1,
            	}
            	var esto = {
            	  method: 'POST',
            	  body: JSON.stringify(datos),
            	  headers:{
            	    'Content-type' : "application/json"
            	  }
            	};
            	fetch(this.url+'/almacen/Vue_filter_data_pedidos',esto)
            	.then(res => res.json())
            	.catch(error => console.error('Error:', error))
            	.then(data => {
					if(data.success == false){
						swal.fire(
                        	'Error!',
                        	'<label style="color:red;">'+data.msg+'</label>',
                        	'error'
                    	)
						
					}else{
						this.list_pedidos = data	
					}
					
									
				})
			}
			
		}
	})
</script>
</body>
</html>

